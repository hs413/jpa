# 4. ì—°ê´€ê´€ê³„ ë§¤í•‘1

## ì—°ê´€ê´€ê³„ì˜ í•„ìš”ì„±

### í…Œì´ë¸”ì— ë§ì¶˜ ëª¨ë¸ë§

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled.png)

ì°¸ì¡° ëŒ€ì‹ ,Â `MEMBER`Â í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤,Â `TEAM_ID`ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•œë‹¤.

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name="MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @Column(name="TEAM_ID")
    private Long teamId;
}

@Entity
public class Team {

    @Id @GeneratedValue
    @Column(name = "TEAM_ID")
    private Long id;
    private String name;
}

//íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA"); em.persist(team);

//íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1"); 
member.setTeamId(team.getId()); // ê°ì²´ì§€í–¥ì ì¸ ë°©ë²•ì´ ì•„ë‹˜
em.persist(member);
```

â€¢ `member.setTeamId(team.getId());`Â : ì™¸ë˜ í‚¤ ì‹ë³„ìë¥¼ ì§ì ‘ ë‹¤ë£¬ë‹¤.

```java
// ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId());

// ì—°ê´€ê´€ê³„ê°€ ì—†ìŒ
Team findTeam = em.find(Team.class, team.getId());
```

- `member`ë¥¼ ì¡°íšŒí•´ì™”ìŒì—ë„Â `member`ê°€ ì†í•œ íŒ€ì„ ì•Œê¸° ìœ„í•´ì„œ**`member`ê°€ ê°€ì§„Â `team.id`, ì¦‰ ì‹ë³„ìë¡œ í…Œì´ë¸”ì„ ê²€ìƒ‰í•´ì„œ ê°€ì ¸ì™€ì•¼ í•œë‹¤.**
- **ì´ëŠ” ì—°ê´€ê´€ê³„ê°€ ì—†ê¸° ë•Œë¬¸ì´ë©°, ê°ì²´ì§€í–¥ì ì¸ ë°©ë²•ì´ ì•„ë‹˜**

<aside>
ğŸ’¡ ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ë°ì´í„° ì¤‘ì‹¬ìœ¼ë¡œ ëª¨ë¸ë§í•˜ë©´,Â **í˜‘ë ¥ê´€ê³„ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ë‹¤.**

- **í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ë¡œ ì¡°ì¸**ì„ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ í…Œì´ë¸”ì„ ì°¾ëŠ”ë‹¤.
- **ê°ì²´ëŠ” ì°¸ì¡°**ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ëœ ê°ì²´ë¥¼ ì°¾ëŠ”ë‹¤.
</aside>

## ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„

### ê°ì²´ ì§€í–¥ ëª¨ë¸ë§

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%201.png)

- `TEAM`ì˜Â `id`ê°€ ì•„ë‹ŒÂ **`TEAM`ì˜ ì°¸ì¡° ê°’ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¨ë‹¤.**
- `MEMBER`Â ê°ì²´ì˜Â `TEAM`Â ì°¸ì¡°ì™€Â `MEMBER`Â í…Œì´ë¸”ì˜Â `TEAM_ID(FK)`ë¥¼ ë§¤í•‘í•´ì•¼ í•œë‹¤.

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name="MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne
    @JoinColumn(name = "TEAM_ID")
    private Team team;
```

- ë§´ë²„ ì—¬ëŸ¬ ëª…ì€ í•œ íŒ€ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆê³ , íŒ€ í•˜ë‚˜ëŠ” ì—¬ëŸ¬ ëª…ì˜ ë§´ë²„ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤
- Member : Team = N : 1 ê´€ê³„ (ë‹¤ëŒ€ì¼ ê´€ê³„) â†’  @ManyToOne
- **dbì—ì„œëŠ” Nìª½ì´ ì™¸ë˜í‚¤ê°€ ìˆëŠ” ê³³**ì´ë‹¤
- **ì™¸ë˜í‚¤ê°€ ìˆëŠ” ê³³(N)ì—**,Â `@JoinColumn`(name =Â **ì—°ê´€ê´€ê³„ìˆëŠ” ì—”í‹°í‹°ì˜ ì‹ë³„ì**)ë¥¼ ì ìš©í•œë‹¤.

### ORM ë§¤í•‘

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%202.png)

### ì—°ê´€ê´€ê³„ ì €ì¥

```java
// íŒ€ ì €ì¥
Team team = new Team();
team.setName("TeamA");
em.persist(team);

// íšŒì› ì €ì¥
Member member = new Member();
member.setName("member1");
member.setTeam(team); //ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ ì„¤ì •, ì°¸ì¡° ì €ì¥
em.persist(member);
```

### **ì—°ê´€ê´€ê³„ ì¡°íšŒ - ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**

```java
//ì¡°íšŒ
Member findMember = em.find(Member.class, member.getId());

//ì°¸ì¡°ë¥¼ ì‚¬ìš©í•´ì„œ ì—°ê´€ê´€ê³„ ì¡°íšŒ
Team findTeam = findMember.getTeam();
```

### **ì—°ê´€ê´€ê³„ ìˆ˜ì •**

```java
// ìƒˆë¡œìš´ íŒ€B
Team teamB = new Team();
teamB.setName("TeamB");
em.persist(teamB);

// íšŒì›1ì— ìƒˆë¡œìš´ íŒ€B ì„¤ì • 
member.setTeam(teamB);
```

## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„, ì—°ê´€ê´€ì¸ ì£¼ì¸

- ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì–‘ìª½ì— 2ê°œ ìˆëŠ” ê²ƒì´ë¼ê³  ìƒê°í•˜ë©´ ë¨
    
    ![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%203.png)
    
- Member EntityëŠ” ë‹¨ë°©í–¥ê³¼ ë™ì¼
- Team EntityëŠ”Â **List<Member> ì»¬ë ‰ì…˜ ì¶”ê°€**
    
    ```java
    @Entity
    public class Team {
    
        @Id
        @GeneratedValue
        @Column(name = "TEAM_ID")
        private Long id;
        
        private String name;
    
        @OneToMany(mappedBy = "team")
        private List<Member> members = new ArrayList<>();
    }
    ```
    
- íŒ€ê³¼ íšŒì›ì€ ì¼ëŒ€ë‹¤ ê´€ê³„ â†’ @OneToMany
- ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•´Â `@OneToMany`Â ë¥¼ ì‚¬ìš©
    - **`mappedBy`Â ì†ì„±ì€ ì–‘ë°©í–¥ ë§¤í•‘ì¼ ë•Œ ì‚¬ìš©, ë°˜ëŒ€ìª½ ë§¤í•‘ í•„ë“œì˜ ì´ë¦„ì„ ê°’ìœ¼ë¡œ ì£¼ë©´ ëœë‹¤.**
- ì»¬ë ‰ì…˜ì€Â `new ArrayList<>()`ë¡œ ì´ˆê¸°í™” í•´ Null Point Exceptionì„ ë°©ì§€í•´ì£¼ëŠ” ê²ƒì´ ê´€ë¡€
- ì–‘ë°©í–¥ ë§¤í•‘ìœ¼ë¡œ íŒ€ ê°ì²´ë¥¼ í†µí•´ ë©¤ë²„ë¥¼ ì°¾ëŠ” ê²ƒë„ ê°€ëŠ¥í•´ì§

### **ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰**

```java
//ì¡°íšŒ
Team findTeam = em.find(Team.class, team.getId());

int memberSize = findTeam.getMembers().size(); //ì—­ë°©í–¥ ì¡°íšŒ
```

### **ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„**

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%204.png)

- ê°ì²´ì—ëŠ” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ ì—†ë‹¤.
- **ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ 2ê°œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ìœ¼ë¡œ ë¬¶ì–´ ì–‘ë°©í–¥ì¸ ê²ƒì²˜ëŸ¼ í‘œí˜„í•˜ëŠ” ê²ƒ**
- ì¦‰, ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

```java
A â†’ B (a.getB())
B â†’ A (b.getA())

class A{
	B b;
}

class B{
	A a;
}
```

### **í…Œì´ë¸” ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„**

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%205.png)

- **í…Œì´ë¸”ì€ ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤**

```sql
SELECT *
FROM MEMBER M
JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

SELECT *
FROM TEAM T
JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
```

### **ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™ - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸**

- ì–‘ë°©í–¥ ë§¤í•‘ì—ì„œëŠ” ì—°ê´€ê°„ê³„ ì¤‘ í•˜ë‚˜ë¥¼ ì£¼ì¸ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•œë‹¤.
- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)í•  ìˆ˜ ìˆë‹¤.**
- ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥í•˜ë‹¤.
- ì£¼ì¸ì€Â `mappedBy`Â ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì£¼ì¸ì´ ì•„ë‹ˆë©´Â `mappedBy`Â ì†ì„±ìœ¼ë¡œ ì£¼ì¸ì„ ì§€ì •í•´ì•¼ í•œë‹¤.

![Untitled](4%20%E1%84%8B%E1%85%A7%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%AA%E1%86%AB%E1%84%80%E1%85%A8%20%E1%84%86%E1%85%A2%E1%84%91%E1%85%B5%E1%86%BC1%2031e9c737da594bad8dbeba864f73fe41/Untitled%206.png)

<aside>
ğŸ’¡ **ì—°ê´€ê´€ê³„ ì£¼ì¸ = ì™¸ë˜ í‚¤ ê´€ë¦¬ì**

- íšŒì› í…Œì´ë¸”ì— ìˆëŠ”Â `TEAM_ID`Â ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•  ê´€ë¦¬ìë¥¼ ì„ íƒí•´ì•¼ ëœë‹¤.
- ë§Œì•½ íšŒì› ì—”í‹°í‹°ì— ìˆëŠ”Â `Member.team`ì„ ì£¼ì¸ìœ¼ë¡œ ì„ íƒí•˜ë©´ ìê¸° í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•˜ë©´ ëœë‹¤.
- í•˜ì§€ë§Œ íŒ€ ì—”í‹°í‹°ì— ìˆëŠ”Â `Team.members`ë¥¼ ì£¼ì¸ìœ¼ë¡œ ì„ íƒí•˜ë©´ ë¬¼ë¦¬ì ìœ¼ë¡œ ì „í˜€ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.
- ì´ ê²½ìš°Â `Team.members`ê°€ ìˆëŠ”Â `Team`Â ì—”í‹°í‹°ëŠ”Â `TEAM`Â í…Œì´ë¸”ì— ë§¤í•‘ë˜ì–´ ìˆëŠ”ë° ê´€ë¦¬í•´ì•¼í•  ì™¸ë˜ í‚¤ëŠ”Â `MEMBER`ì— ìˆê¸° ë•Œë¬¸ì´ë‹¤.
</aside>

### **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ - ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³**

- **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì€ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ìœ¼ë¡œ ì •í•œë‹¤.**
- **dbì…ì¥**ì—ì„œ ë³´ë©´ **ì™¸ë˜ í‚¤ê°€ ìˆëŠ”ê³³ì´ â€˜ë‹¤â€™ì´ë©° ë¬´ì¡°ê±´ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ëœë‹¤**

### **ì£¼ì˜ ì‚¬í•­**

- ì—°ê´€ê´€ê³„ ì£¼ì¸ ê°’ì„ ì…ë ¥í•˜ì§€ ì•Šìœ¼ë©´ ì™¸ë˜ í‚¤ ë°ì´í„°ê°€ ë“¤ì–´ê°€ì§€ ì•ŠìŒ
    
    ```java
    Team team = new Team();
    team.setName("TeamA");
    em.persist(team);
    
    Member member = new Member();
    member.setName("member1");
    
    //ì—­ë°©í–¥(ì£¼ì¸ì´ ì•„ë‹Œ ë°©í–¥)ë§Œ ì—°ê´€ê´€ê³„ ì„¤ì •
    team.getMembers().add(member);
    
    em.persist(member);
    ```
    
- **ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ì„ ì…ë ¥í•´ì•¼ í•¨**
    
    ```java
    Team team = new Team();
    team.setName("TeamA");
    em.persist(team);
    
    Member member = new Member();
    member.setName("member1");
    
    team.getMembers().add(member);
    //ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— ê°’ ì„¤ì •
    member.setTeam(team); //**
    
    em.persist(member);
    ```
    
- **ì–‘ë°©í–¥ ë§¤í•‘ì—ì„œëŠ” ì–‘ìª½ì— ëª¨ë‘ ê°’ì„ ë„£ì–´ì£¼ëŠ” ê²Œ ì¢‹ë‹¤**
- ì–‘ìª½ ê°’ì„ ì…ë ¥ í•˜ì§€ ì•Šì€ ê²½ìš° ë¬¸ì œì 
    - **flush, clearì„ í•˜ì§€ ì•ŠëŠ” ê²½ìš°**
        - teamì„ ì˜ì† ì—”í‹°í‹°ë¡œ ë“±ë¡ â†’ 1ì°¨ ìºì‰¬ë¡œ ì €ì¥
        - ì´ ë•Œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì •ë¦¬í•˜ì§€ ì•Šê³  Teamì˜ ì»¬ë ‰ì…˜ membersë¥¼ ì¡°íšŒí•˜ë©´ ìºì‹œì— ë‚¨ì•„ìˆëŠ” ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¨ë‹¤. (new ArrayListë¡œ ì´ˆê¸°í™” ë¨)
    - test í•˜ëŠ” ê²½ìš°
        - test caseì—ì„œëŠ” JPAë¥¼ ì´ìš©í•˜ê¸° ë³´ë‹¤ëŠ” ìˆœìˆ˜í•œ ê°ì²´ë¥¼ ì´ìš©
        - jpaê°€ ì—°ê´€ê´€ê³„ë¥¼ ë„£ì–´ì£¼ì§€ ëª»í•˜ë¯€ë¡œ, ì–‘ìª½ ê°ì²´ì— ê°’ì„ ë„£ì–´ì¤˜ì•¼ ë§¤í•‘ ê°€ëŠ¥
- **ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©**
    - ì–‘ìª½ì— ìˆì„ ê²½ìš° ë¬¸ì œì˜ ì†Œì§€ê°€ ë  í™•ë¥ ì´ ë†’ìœ¼ë‹ˆ í•œ ìª½ì—ë§Œ ìƒì„±
    
    ```java
    // Member Entity í¸ì˜ ë©”ì„œë“œ
    public void changeTeam(Team team) { // ë¡œì§ì´ ì„ì—¬ìˆì„ ê²½ìš° Getter, Setter ì‚¬ìš©ì„ í”¼í•˜ì.
        this.team = team;
        team.getMembers().add(this);
    }
    
    // Team Entity í¸ì˜ ë©”ì„œë“œ -> Member Entityì—ì„œ ì •ì˜ í–ˆê¸° ë•Œë¬¸ì— ì—†ì–´ë„ ë¨
    public void addMember(Member member) {
        member.setTeam(this);
        members.add(member);
    }
    ```
    
- ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ë¬´í•œ ë£¨í”„ ì¡°ì‹¬
    - ì˜ˆ:Â toString(), lombok, JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬
    - ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ Entityë¥¼ ì ˆëŒ€ ë°˜í™˜í•˜ì§€ ë§ê³  DTOë¡œ ë°˜í™˜í•  ê²ƒ
        - JSON ìƒì„± ì‹œ ë¬´í•œ ë£¨í”„ ê°€ëŠ¥ì„±
        - ì—”í‹°í‹° ë³€ê²½ ì‹œ API Specì´ ë³€ê²½ë¨
- **ë‹¨ë°©í–¥ ë§¤í•‘ë§Œìœ¼ë¡œ ì—°ê´€ê´€ê³„ ë§¤í•‘ì€ ì™„ë£Œëœë‹¤ â†’** **ë‹¨ë°©í–¥ìœ¼ë¡œ ì„¤ê³„ í›„ ì¶”ê°€**